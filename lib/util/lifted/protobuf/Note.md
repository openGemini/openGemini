This code is originally from: https://github.com/gogo/protobuf/tree/v1.3.2/proto
